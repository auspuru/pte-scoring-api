<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTE SWT Practice Portal</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f0f4f8; min-height: 100vh; padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .header-left { display: flex; align-items: center; gap: 12px; }
    .logo { font-size: 1.1rem; font-weight: 600; color: #333; }
    .ai-badge { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: #e8f5e9; border-radius: 4px; font-size: 0.8rem; color: #388e3c; }
    .ai-badge.offline { background: #ffebee; color: #c62828; }
    .ai-badge.cached { background: #fff3e0; color: #e65100; }
    .header-right { display: flex; gap: 8px; }
    .btn-sm { padding: 6px 14px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
    .passage-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .nav-left { display: flex; align-items: center; gap: 12px; }
    .nav-btn { padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
    .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .passage-counter { font-size: 0.9rem; color: #666; }
    .mode-toggle { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: #666; }
    .toggle { width: 40px; height: 22px; background: #ccc; border-radius: 11px; position: relative; cursor: pointer; transition: background 0.2s; }
    .toggle.active { background: #4caf50; }
    .toggle::after { content: ''; position: absolute; width: 18px; height: 18px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: transform 0.2s; }
    .toggle.active::after { transform: translateX(18px); }
    .card { background: white; border-radius: 12px; padding: 24px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .passage-meta { display: flex; gap: 8px; margin-bottom: 12px; }
    .tag { padding: 4px 10px; background: #e3f2fd; color: #1976d2; border-radius: 4px; font-size: 0.75rem; font-weight: 500; }
    .passage-title { font-size: 1rem; font-weight: 600; color: #333; margin-bottom: 16px; }
    .passage-text { line-height: 1.8; color: #444; font-size: 0.95rem; }
    .key-points-btn { margin-top: 16px; padding: 8px 16px; background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: #666; }
    .key-points { display: none; margin-top: 16px; padding: 16px; background: #fff8e1; border-radius: 8px; }
    .key-points.show { display: block; }
    .key-point { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; font-size: 0.9rem; }
    .key-point:last-child { margin-bottom: 0; }
    .kp-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 700; flex-shrink: 0; }
    .kp-icon.topic { background: #e3f2fd; color: #1976d2; }
    .kp-icon.pivot { background: #fff3e0; color: #f57c00; }
    .kp-icon.conclusion { background: #e8f5e9; color: #388e3c; }
    .input-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .input-label { font-size: 0.9rem; color: #4caf50; font-weight: 500; }
    .word-count { font-size: 0.9rem; color: #ff9800; }
    .word-count.error { color: #f44336; }
    .word-count.success { color: #4caf50; }
    textarea { width: 100%; min-height: 100px; padding: 16px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; resize: vertical; font-family: inherit; }
    textarea:focus { outline: none; border-color: #4caf50; }
    .input-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
    .word-range { font-size: 0.8rem; color: #888; }
    .btn-group { display: flex; gap: 10px; }
    .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; }
    .btn-secondary { background: #f5f5f5; color: #333; border: 1px solid #ddd; }
    .btn-primary { background: #4caf50; color: white; }
    .btn-primary:hover { background: #45a049; }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
    .results { display: none; margin-top: 20px; }
    .results.show { display: block; }
    .score-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
    .main-score { font-size: 3rem; font-weight: 700; color: #1976d2; }
    .score-info { display: flex; flex-direction: column; gap: 4px; }
    .band { font-size: 1.2rem; font-weight: 600; color: #1976d2; }
    .raw-score { font-size: 0.85rem; color: #666; }
    .mode-tag { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: #e3f2fd; border-radius: 4px; font-size: 0.75rem; color: #1976d2; }
    .feedback-text { background: #f5f5f5; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; color: #555; line-height: 1.6; }
    .elements-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
    .element-card { padding: 16px; border-radius: 8px; border: 2px solid #e0e0e0; }
    .element-card.captured { border-color: #4caf50; background: #f1f8e9; }
    .element-card.missed { border-color: #f44336; background: #ffebee; }
    .element-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .element-label { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
    .element-label.topic { background: #e3f2fd; color: #1976d2; }
    .element-label.pivot { background: #fff3e0; color: #f57c00; }
    .element-label.conclusion { background: #e8f5e9; color: #388e3c; }
    .element-check { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; }
    .element-card.captured .element-check { background: #4caf50; color: white; }
    .element-card.missed .element-check { background: #f44336; color: white; }
    .element-text { font-size: 0.85rem; color: #555; line-height: 1.5; }
    .traits-section { margin-top: 20px; }
    .traits-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; font-size: 0.85rem; color: #666; font-weight: 600; }
    .traits-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .trait-box { padding: 16px; border-radius: 8px; border: 2px solid #e0e0e0; }
    .trait-box.good { border-color: #4caf50; background: #f1f8e9; }
    .trait-box.medium { border-color: #ff9800; background: #fff8e1; }
    .trait-box.poor { border-color: #f44336; background: #ffebee; }
    .trait-name { font-size: 0.75rem; color: #666; margin-bottom: 4px; text-transform: uppercase; }
    .trait-score { font-size: 1.5rem; font-weight: 700; color: #333; margin-bottom: 4px; }
    .trait-box.good .trait-score { color: #2e7d32; }
    .trait-box.medium .trait-score { color: #ef6c00; }
    .trait-box.poor .trait-score { color: #c62828; }
    .trait-detail { font-size: 0.75rem; color: #888; }
    .issues-section { margin-top: 16px; padding: 16px; border-radius: 8px; }
    .issues-section.spelling { background: #fff3e0; }
    .issues-section.grammar { background: #fce4ec; }
    .issues-section.vocab { background: #e8f5e9; }
    .issues-section.warning { background: #ffebee; }
    .issues-section.insights { background: #e3f2fd; border: 2px solid #1976d2; }
    .issues-title { font-size: 0.85rem; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .issues-section.spelling .issues-title { color: #e65100; }
    .issues-section.grammar .issues-title { color: #c2185b; }
    .issues-section.vocab .issues-title { color: #2e7d32; }
    .issues-section.warning .issues-title { color: #c62828; }
    .issues-section.insights .issues-title { color: #1976d2; }
    .issue-item { font-size: 0.85rem; padding: 6px 0; border-bottom: 1px dashed rgba(0,0,0,0.1); }
    .issue-item:last-child { border-bottom: none; }
    .issue-word { text-decoration: line-through; color: #d32f2f; }
    .issue-arrow { margin: 0 8px; color: #666; }
    .issue-fix { color: #388e3c; font-weight: 500; }
    .issue-rule { color: #888; font-size: 0.75rem; margin-left: 8px; }
    .vocab-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 6px; margin-bottom: 4px; }
    .vocab-badge.swap { background: #e8f5e9; color: #2e7d32; }
    .vocab-badge.compression { background: #e3f2fd; color: #1976d2; }
    .progress-section { margin-top: 20px; }
    .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .progress-title { font-size: 0.95rem; font-weight: 600; color: #333; }
    .progress-stats { font-size: 0.85rem; color: #666; }
    .progress-stats strong { color: #4caf50; font-size: 1.2rem; }
    .passage-dots { display: grid; grid-template-columns: repeat(21, 1fr); gap: 6px; }
    .dot { aspect-ratio: 1; border-radius: 4px; background: #e0e0e0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #666; }
    .dot:hover { background: #bdbdbd; }
    .dot.active { background: #4caf50; color: white; }
    .dot.attempted { background: #81c784; color: white; }
    .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); align-items: center; justify-content: center; z-index: 1000; }
    .loading-overlay.show { display: flex; }
    .spinner { width: 50px; height: 50px; border: 4px solid #e0e0e0; border-top-color: #4caf50; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { margin-top: 16px; color: #666; text-align: center; }
    .form-error-banner { background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    .form-error-banner .title { color: #c62828; font-weight: 600; margin-bottom: 8px; }
    .form-error-banner .reason { color: #666; font-size: 0.9rem; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal-overlay.show { display: flex; }
    .modal { background: white; border-radius: 16px; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlide 0.3s ease; }
    @keyframes modalSlide { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .modal-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 16px 16px 0 0; }
    .modal-header h2 { font-size: 1.5rem; margin-bottom: 8px; }
    .modal-header p { opacity: 0.9; font-size: 0.95rem; }
    .modal-body { padding: 24px; }
    .instruction-section { margin-bottom: 24px; }
    .instruction-section:last-child { margin-bottom: 0; }
    .instruction-title { display: flex; align-items: center; gap: 10px; font-size: 1.1rem; font-weight: 600; color: #333; margin-bottom: 12px; }
    .instruction-title .icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
    .instruction-title .icon.blue { background: #e3f2fd; }
    .instruction-title .icon.green { background: #e8f5e9; }
    .instruction-title .icon.orange { background: #fff3e0; }
    .instruction-title .icon.purple { background: #f3e5f5; }
    .instruction-content { padding-left: 42px; }
    .instruction-content p { color: #555; line-height: 1.7; margin-bottom: 10px; }
    .instruction-content ul { margin-left: 20px; color: #555; line-height: 1.8; }
    .instruction-content li { margin-bottom: 6px; }
    .example-box { background: #f8f9fa; border-left: 4px solid #4caf50; padding: 16px; border-radius: 8px; margin: 12px 0; }
    .example-box .label { font-size: 0.8rem; color: #4caf50; font-weight: 600; margin-bottom: 8px; text-transform: uppercase; }
    .example-box .text { color: #333; font-style: italic; }
    .scoring-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 12px; }
    .scoring-item { background: #f8f9fa; padding: 16px; border-radius: 10px; text-align: center; }
    .scoring-item .name { font-size: 0.85rem; color: #666; margin-bottom: 4px; }
    .scoring-item .score { font-size: 1.3rem; font-weight: 700; color: #333; }
    .scoring-item .desc { font-size: 0.75rem; color: #888; margin-top: 4px; }
    .tip-box { background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); border-radius: 10px; padding: 16px; margin-top: 16px; }
    .tip-box .tip-title { display: flex; align-items: center; gap: 8px; font-weight: 600; color: #f57c00; margin-bottom: 8px; }
    .tip-box ul { margin-left: 20px; color: #666; font-size: 0.9rem; line-height: 1.7; }
    .modal-footer { padding: 16px 24px 24px; display: flex; justify-content: center; }
    .btn-close { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 40px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .btn-close:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4); }
    .structure-visual { display: flex; align-items: center; gap: 8px; margin: 16px 0; padding: 16px; background: #f8f9fa; border-radius: 10px; }
    .structure-item { flex: 1; text-align: center; padding: 12px; border-radius: 8px; font-size: 0.85rem; font-weight: 500; }
    .structure-item.topic { background: #e3f2fd; color: #1976d2; }
    .structure-item.pivot { background: #fff3e0; color: #f57c00; }
    .structure-item.conclusion { background: #e8f5e9; color: #388e3c; }
    .structure-arrow { color: #bbb; font-size: 1.2rem; }
    .connector-info { margin-top: 8px; font-size: 0.8rem; }
    .connector-info .type { display: inline-block; padding: 2px 8px; border-radius: 4px; margin-right: 6px; }
    .connector-info .type.contrast { background: #fff3e0; color: #e65100; }
    .connector-info .type.addition { background: #e3f2fd; color: #1976d2; }
    .connector-info .type.reason { background: #e8f5e9; color: #388e3c; }
    .connector-info .logic { color: #4caf50; }
    .connector-info .logic.bad { color: #f44336; }
    .insight-box { margin-top: 12px; padding: 12px; background: rgba(25, 118, 210, 0.1); border-radius: 6px; font-size: 0.85rem; }
    .insight-item { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px; }
    .insight-item:last-child { margin-bottom: 0; }
    .insight-icon { color: #1976d2; font-weight: bold; }
  </style>
<base target="_blank">
<base target="_blank">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <div class="logo">PTE Academic - Summarize Written Text</div>
        <div class="ai-badge" id="aiStatus"><span>‚óè</span> Checking...</div>
      </div>
      <div class="header-right">
        <button class="btn-sm" onclick="showInstructions()">Instructions</button>
        <button class="btn-sm" onclick="toggleTimer()">Timer: <span id="timerText">Off</span></button>
      </div>
    </div>

    <div class="passage-nav">
      <div class="nav-left">
        <button class="nav-btn" id="prevBtn" onclick="prevPassage()">‚Üê Previous</button>
        <span class="passage-counter">Passage <span id="currentNum">1</span> of <span id="totalNum">21</span></span>
        <button class="nav-btn" id="nextBtn" onclick="nextPassage()">Next ‚Üí</button>
      </div>
      <div class="mode-toggle">
        <span>Easy Mode</span>
        <div class="toggle" id="easyToggle" onclick="toggleEasyMode()"></div>
      </div>
    </div>

    <div class="card">
      <div class="passage-meta">
        <span class="tag" id="passageCategory">Category</span>
      </div>
      <div class="passage-title" id="passageTitle">Title</div>
      <div class="passage-text" id="passageText">Loading...</div>
      <button class="key-points-btn" id="kpBtn" onclick="toggleKeyPoints()">Click to show key points</button>
      <div class="key-points" id="keyPoints"></div>
    </div>

    <div class="card">
      <div class="input-header">
        <span class="input-label">* Summarize in the box below (between 5 and 75 words)</span>
        <span class="word-count" id="wordCount">0 words</span>
      </div>
      <textarea id="summaryInput" placeholder="Start typing..." oninput="updateWordCount()"></textarea>
      <div class="input-footer">
        <span class="word-range">5-75 words</span>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="jumpToPassage()">Jump to passage</button>
          <button class="btn btn-primary" id="verifyBtn" onclick="verifySummary()">Verify</button>
        </div>
      </div>
    </div>

    <div class="results" id="results">
      <div class="card">
        <div class="form-error-banner" id="formErrorBanner" style="display: none;">
          <div class="title">‚ö†Ô∏è Form Check Failed</div>
          <div class="reason" id="formErrorReason"></div>
        </div>

        <div class="score-header">
          <div class="main-score" id="mainScore">0/90</div>
          <div class="score-info">
            <div class="band" id="bandDisplay">Band 5</div>
            <div class="raw-score" id="rawDisplay">Raw: 0/7</div>
            <div class="mode-tag" id="modeDisplay">üìä Local</div>
          </div>
        </div>
        <div class="feedback-text" id="feedbackText"></div>

        <div class="elements-grid" id="elementsGrid"></div>

        <div class="issues-section warning" id="firstPersonWarning" style="display: none;">
          <div class="issues-title">‚ö†Ô∏è First-Person Trap</div>
          <div id="firstPersonContent"></div>
        </div>

        <div class="issues-section spelling" id="spellCheckSection" style="display: none;">
          <div class="issues-title">üî§ Spelling Issues</div>
          <div id="spellCheckContent"></div>
        </div>

        <div class="issues-section grammar" id="grammarSection" style="display: none;">
          <div class="issues-title">‚úèÔ∏è Grammar Issues</div>
          <div id="grammarContent"></div>
          <div class="connector-info" id="connectorInfo"></div>
        </div>

        <div class="issues-section vocab" id="vocabSection" style="display: none;">
          <div class="issues-title">üìö Vocabulary Analysis</div>
          <div id="vocabContent"></div>
        </div>

        <div class="issues-section insights" id="insightsSection" style="display: none;">
          <div class="issues-title">üéØ Band 9 Insights</div>
          <div id="insightsContent"></div>
        </div>

        <div class="traits-section">
          <div class="traits-header">üìä PTE TRAIT SCORES</div>
          <div class="traits-grid" id="traitsGrid"></div>
        </div>
      </div>
    </div>

    <div class="card progress-section">
      <div class="progress-header">
        <div class="progress-title">PTE Academic Practice Portal</div>
        <div class="progress-stats"><strong id="completedCount">0</strong> of 21 passages completed</div>
      </div>
      <div class="passage-dots" id="passageDots"></div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div>
      <div class="spinner"></div>
      <div class="loading-text">Grading with AI...</div>
    </div>
  </div>

  <div class="modal-overlay" id="instructionsModal" onclick="closeInstructions(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>üìö How to Summarize Written Text</h2>
        <p>Master the PTE Academic Summarize Written Text task with these guidelines</p>
      </div>
      <div class="modal-body">
        <div class="instruction-section">
          <div class="instruction-title">
            <span class="icon blue">üìù</span>
            Task Overview
          </div>
          <div class="instruction-content">
            <p>Read a passage of up to 300 words and write a <strong>ONE sentence summary</strong> in 5-75 words.</p>
            <div class="example-box">
              <div class="label">Example Summary</div>
              <div class="text">"While remote work increases productivity, collaboration suffers without face-to-face interaction, so hybrid models offer the best balance."</div>
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <div class="instruction-title">
            <span class="icon green">üéØ</span>
            The TOPIC-PIVOT-CONCLUSION Structure
          </div>
          <div class="instruction-content">
            <p>Your summary must capture all three key elements from the passage:</p>
            <div class="structure-visual">
              <div class="structure-item topic">TOPIC<br><small>Main subject</small></div>
              <span class="structure-arrow">‚Üí</span>
              <div class="structure-item pivot">PIVOT<br><small>Contrast/Shift</small></div>
              <span class="structure-arrow">‚Üí</span>
              <div class="structure-item conclusion">CONCLUSION<br><small>Final point</small></div>
            </div>
            <ul>
              <li><strong>Topic:</strong> The main idea or subject of the passage</li>
              <li><strong>Pivot:</strong> A contrast, problem, or shift in perspective</li>
              <li><strong>Conclusion:</strong> The final outcome, solution, or recommendation</li>
            </ul>
          </div>
        </div>

        <div class="instruction-section">
          <div class="instruction-title">
            <span class="icon orange">üîó</span>
            Use Connectors
          </div>
          <div class="instruction-content">
            <p>Connectors improve your grammar score. Use semicolons before them:</p>
            <div class="example-box">
              <div class="label">Good Examples</div>
              <div class="text">...loss of 10% GDP; <strong>however</strong>, developing nations...<br>...minimal emissions; <strong>therefore</strong>, renewable...</div>
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <div class="instruction-title">
            <span class="icon purple">üìä</span>
            Scoring Breakdown
          </div>
          <div class="instruction-content">
            <div class="scoring-grid">
              <div class="scoring-item">
                <div class="name">Form</div>
                <div class="score">0-1</div>
                <div class="desc">5-75 words, one sentence</div>
              </div>
              <div class="scoring-item">
                <div class="name">Content</div>
                <div class="score">0-2</div>
                <div class="desc">Topic, Pivot, Conclusion</div>
              </div>
              <div class="scoring-item">
                <div class="name">Grammar</div>
                <div class="score">0-2</div>
                <div class="desc">Spelling, connectors</div>
              </div>
              <div class="scoring-item">
                <div class="name">Vocabulary</div>
                <div class="score">0-2</div>
                <div class="desc">Appropriate word choice</div>
              </div>
            </div>
          </div>
        </div>

        <div class="tip-box">
          <div class="tip-title">üí° Pro Tips</div>
          <ul>
            <li><strong>Verbatim is OK:</strong> Copying key phrases is acceptable for content score</li>
            <li><strong>33 words can be Band 9:</strong> Short summaries score full points if all key ideas captured</li>
            <li>Use <strong>Easy Mode</strong> to see the key points before writing</li>
            <li>Always end your summary with a <strong>period</strong></li>
            <li>Use <strong>semicolons</strong> before connectors (e.g., "; however,")</li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-close" onclick="closeInstructions()">Got it!</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'https://pte-scoring-api-production.up.railway.app';
    
    const passages = [
      {
        id: 1,
        title: "Climate Change Economics",
        category: "Environment/Economics",
        text: `Have you ever wondered what the true economic cost of climate change really is? "We are looking at a potential loss of 10% of global GDP by 2050 if we fail to act," warns Dr. Sarah Chen, lead economist at the International Climate Research Institute. Her team's analysis reveals that coastal cities alone face damages exceeding $1 trillion annually by 2040. "The question is not whether we can afford to address climate change," Chen emphasizes, "but whether we can afford not to?" The data paints a stark picture: agricultural yields in developing nations could drop by 25% within two decades, while extreme weather events have already increased by 46% since 2000. "Every degree of warming matters," states the report. "At 1.5¬∞C, we lose 70% of coral reefs. At 2¬∞C, we lose 99%." The insurance industry reports that climate-related claims have surged by 340% in the past decade. "Is this sustainable?" asks Michael Torres, CEO of Global Insurance Partners. "Absolutely not." Developing nations, despite contributing less than 10% of historical emissions, will bear 75% of the costs. "Where is the justice in that?" demands Dr. Amara Okafor, climate justice advocate. The renewable energy transition, however, offers hope. "We have seen solar costs drop by 89% and wind by 70% since 2010," reports the International Energy Agency. "Can we scale fast enough?" The answer, according to their models, requires $4 trillion in annual investment. "Is that a lot?" asks Chen. "It's less than 5% of global military spending."`,
        keyElements: { 
          topic: "Potential 10% global GDP loss by 2050 without climate action", 
          pivot: "Developing nations bear 75% of costs despite minimal emissions", 
          conclusion: "Renewable transition requires $4 trillion annual investment" 
        }
      },
      {
        id: 2,
        title: "Artificial Intelligence in Healthcare",
        category: "Technology/Health",
        text: `"AI will transform medicine more dramatically than any technology since the discovery of antibiotics," declares Dr. James Whitmore, Chief of Medical Innovation at Johns Hopkins. But what does the data actually show? A comprehensive study of 2.3 million patient records reveals that AI diagnostic tools achieved 94.7% accuracy in detecting early-stage cancers, compared to 86.3% for human specialists alone. "The question is not whether AI is better," Whitmore clarifies, "but how we combine human judgment with machine precision?" The implementation has been rapid: 67% of major hospitals now use AI for radiology, and surgical robots assisted in over 1.2 million procedures last year. "Are we moving too fast?" asks Dr. Elena Vasquez, medical ethicist. "We've seen 23 documented cases of AI-related diagnostic errors in the past year alone." The economic implications are staggering. "AI could reduce healthcare costs by $150 billion annually in the US alone," reports the Healthcare Economics Institute. But who benefits? "Hospitals save money, but are patients seeing lower bills?" questions Senator Maria Gonzalez. Workforce disruption is another concern. "Will radiologists become obsolete?" asks Dr. Whitmore. "Not if they adapt. AI handles routine cases; humans focus on complex ones." The technology also raises profound questions about privacy. "We're feeding millions of patient records into algorithms," warns privacy advocate Thomas Reid. "Who owns that data? Who controls it?" Despite concerns, patient acceptance is growing: 58% now trust AI-assisted diagnoses, up from just 23% five years ago. "What changed?" asks Reid. "People saw it work."`,
        keyElements: { 
          topic: "AI diagnostic tools achieved 94.7% accuracy vs 86.3% for human specialists", 
          pivot: "67% of major hospitals use AI but 23 diagnostic errors occurred", 
          conclusion: "AI could reduce healthcare costs by $150 billion annually in US" 
        }
      },
      {
        id: 3,
        title: "The Future of Work",
        category: "Business/Labor",
        text: `"The nine-to-five office job is dead," announces workplace analyst Patricia Okonkwo. "The question is: what replaces it?" Her research across 45 countries reveals that 73% of knowledge workers now work remotely at least part-time, up from just 16% before 2020. "Is this a temporary shift?" she asks. "Our data says no." Companies report mixed results: productivity increased by 13% on average, but collaboration scores dropped by 22%. "What are we sacrificing for efficiency?" questions Dr. Robert Kim, organizational psychologist. The real estate market has been upended. "Commercial vacancy rates in major cities have hit 19%," reports Global Property Analytics. "That's $450 billion in stranded assets." Meanwhile, suburban home prices surged 34% as workers sought more space. "Who wins and who loses?" asks Okonkwo. "Urban service workers face longer commutes to fewer jobs." The skills gap is widening dramatically. "By 2027, 44% of core worker skills will have changed," warns the World Economic Forum. "Are our education systems keeping pace?" Automation threatens 85 million jobs globally by 2025, but could create 97 million new ones. "Is this just creative destruction?" asks Dr. Kim. "Tell that to the displaced worker." Mental health has emerged as a critical concern. "Remote workers report 67% higher rates of isolation and burnout," states a major study. "How do we build connection in distributed teams?" The four-day workweek experiment shows promise: 92% of trial companies reported maintained or improved productivity. "Will this become standard?" asks Okonkwo. "The data suggests it should."`,
        keyElements: { 
          topic: "73% of knowledge workers now work remotely at least part-time", 
          pivot: "Productivity increased 13% but collaboration scores dropped 22%", 
          conclusion: "Four-day workweek shows 92% of companies maintained productivity" 
        }
      },
      {
        id: 4,
        title: "Education Transformation",
        category: "Education",
        text: `"Our education system was designed for the industrial age, not the information age," argues Dr. Fatima Al-Rashid, education reform advocate. "The question is: why are we still using it?" Standardized test scores have remained flat for three decades despite a 287% increase in per-student spending. "Where is the money going?" asks Al-Rashid. "Administrative costs have ballooned while teacher salaries stagnate." The skills mismatch is alarming: 87% of employers report difficulty finding candidates with adequate critical thinking skills, yet only 23% of curricula emphasize these competencies. "What are we actually teaching?" she demands. Technology integration shows promise but uneven results. "Schools with 1:1 device programs see 34% better engagement," reports the Digital Education Institute, "but test scores improve only when devices are paired with teacher training." The pandemic accelerated online learning adoption by an estimated five years. "Did we learn anything?" asks Dr. Marcus Webb, education researcher. "Hybrid models that combine flexibility with human connection show the best outcomes." Student debt has reached crisis levels: $1.7 trillion in the US alone, with average graduates owing $37,000. "Is higher education still worth it?" asks Webb. "For STEM and professional fields, yes. For others, the ROI is questionable." Alternative credentials are gaining traction. "Micro-credentials and bootcamps grew by 340% since 2019," reports the Credential Innovation Lab. "Are degrees becoming obsolete?" asks Al-Rashid. "Not yet, but the monopoly is ending."`,
        keyElements: { 
          topic: "Test scores flat for 30 years despite 287% increase in per-student spending", 
          pivot: "87% of employers report difficulty finding critical thinking skills", 
          conclusion: "Micro-credentials and bootcamps grew by 340% since 2019" 
        }
      },
      {
        id: 5,
        title: "Global Food Security",
        category: "Agriculture/Economics",
        text: `"We are facing the greatest food crisis in human history," warns Dr. Priya Sharma, agricultural economist. "The question is not if famine will spread, but where and when?" The numbers are devastating: 828 million people go hungry every night, an increase of 150 million since 2019. "What changed?" asks Sharma. "Conflict, climate, and COVID created a perfect storm." Crop yields in key regions have declined sharply: wheat production in the Black Sea region dropped 23%, while corn yields in the US Midwest fell 18% due to drought. "Can technology save us?" asks Dr. Kenji Tanaka, plant geneticist. "GMO crops could increase yields by 25%, but face regulatory barriers in 67% of countries." Food waste compounds the crisis: one-third of all food produced is lost or wasted, representing $940 billion annually. "Why do we tolerate this?" demands Sharma. "In developed nations, it's consumer waste. In developing nations, it's infrastructure." The cost of basic staples has skyrocketed: rice prices increased 45%, wheat 38%, and corn 52% in the past two years. "Who suffers most?" asks Tanaka. "The poorest spend 70% of income on food. A price spike means starvation." Vertical farming and alternative proteins offer hope. "Lab-grown meat production costs dropped 99% in a decade," reports the Food Innovation Institute. "When will it scale?" Aquaculture now provides 52% of global fish consumption. "Can we farm our way out of this?" asks Sharma. "Only if we act now."`,
        keyElements: { 
          topic: "828 million people go hungry, up 150 million since 2019", 
          pivot: "One-third of food produced is wasted, costing $940 billion annually", 
          conclusion: "Aquaculture provides 52% of global fish consumption" 
        }
      },
      {
        id: 6,
        title: "Mental Health Crisis",
        category: "Health/Psychology",
        text: `"We are in the midst of a global mental health pandemic," declares Dr. Lisa Wong, psychiatrist and public health researcher. "The question is: why aren't we treating it with the same urgency as COVID-19?" The statistics are staggering: depression affects 280 million people worldwide, anxiety disorders impact 301 million, and suicide claims 700,000 lives annually. "What has changed?" asks Wong. "Social media, economic insecurity, and social isolation have created unprecedented stress." Among teenagers, the crisis is acute: 44% report persistent feelings of sadness or hopelessness, up from 26% in 2009. "Are screens to blame?" asks Dr. Ahmed Hassan, adolescent psychologist. "The correlation is strong: teens spending 5+ hours daily on social media are 71% more likely to show suicidal ideation." Treatment access remains woefully inadequate. "Two-thirds of people with mental health conditions receive no treatment," reports the WHO. "Why? Stigma, cost, and provider shortages." The economic cost is enormous: $1 trillion annually in lost productivity. "Can we afford to ignore this?" asks Wong. "Absolutely not." New treatments offer hope. "Psychedelic-assisted therapy shows 67% efficacy for treatment-resistant depression," reports the Psychiatric Research Institute. "When will it be widely available?" Workplace mental health programs demonstrate ROI: every $1 invested returns $4 in improved productivity. "Why aren't more companies investing?" asks Hassan. "Short-term thinking."`,
        keyElements: { 
          topic: "Depression affects 280 million people worldwide", 
          pivot: "Two-thirds of people with mental health conditions receive no treatment", 
          conclusion: "Every $1 invested in workplace mental health returns $4 in productivity" 
        }
      },
      {
        id: 7,
        title: "Urbanization Challenges",
        category: "Urban Planning",
        text: `"By 2050, 68% of humanity will live in cities," announces urban planner Diego Martinez. "The question is: are our cities ready?" The scale of urban growth is unprecedented: 2.5 billion people will move to cities in the next three decades. "Where will they live?" asks Martinez. "We need to build the equivalent of a new city of 1.5 million people every week for the next 30 years." Infrastructure is already failing. "Traffic congestion costs the US economy $87 billion annually in lost productivity," reports the Transportation Institute. "In Lagos, commuters spend an average of 3 hours daily in traffic. Is that a life?" Affordable housing has become a crisis in virtually every major city. "In London, the median home costs 13 times median income," states the Global Housing Observatory. "In Mumbai, 60% of residents live in informal settlements. What does that say about our priorities?" Air pollution claims 4.2 million lives annually, with 91% of urban populations breathing unsafe air. "Are we literally killing our citizens?" demands Dr. Sarah Johnson, environmental health specialist. Smart city technologies offer partial solutions. "Barcelona saved $75 million annually through IoT-enabled resource management," reports the Smart Cities Alliance. "Can technology solve everything?" asks Martinez. "No. We need political will and inclusive planning." Green spaces are disappearing: cities lost 35% of their tree cover since 1990. "What are we leaving for future generations?"`,
        keyElements: { 
          topic: "By 2050, 68% of humanity will live in cities", 
          pivot: "Traffic congestion costs US economy $87 billion annually", 
          conclusion: "Barcelona saved $75 million annually through smart city technology" 
        }
      },
      {
        id: 8,
        title: "Renewable Energy Revolution",
        category: "Energy/Environment",
        text: `"The energy transition is happening faster than anyone predicted," declares Dr. Anna Petrov, energy systems analyst. "The question is: can we accelerate it even more?" Renewable energy capacity grew by 295 gigawatts in 2022, the largest increase in history. "Solar alone added 191 gigawatts," Petrov reports. "That's equivalent to 95 large nuclear plants." The cost reductions have been dramatic. "Solar photovoltaic costs fell 89% since 2010, onshore wind by 70%, and batteries by 87%," states the International Renewable Energy Agency. "What does this mean?" asks Petrov. "Renewables are now the cheapest source of new electricity in 90% of the world." Investment is flowing: $1.8 trillion was invested in clean energy in 2023, surpassing fossil fuel investment for the first time. "Is this enough?" asks Dr. Michael Chen, climate scientist. "We need $4 trillion annually to stay below 1.5¬∞C of warming." Grid integration presents challenges. "Intermittency requires storage and flexibility," explains Chen. "Battery storage capacity grew 67% in 2022, but we need 20 times more by 2030." Fossil fuel subsidies remain a major obstacle: governments spent $7 trillion propping up oil, gas, and coal in 2022. "Why are we paying to destroy the planet?" demands Petrov. Electric vehicles are gaining ground: 14% of new car sales globally were electric in 2022, up from 4% in 2020. "When will ICE vehicles become obsolete?" asks Chen. "Sooner than automakers think."`,
        keyElements: { 
          topic: "Renewable energy capacity grew by 295 gigawatts in 2022", 
          pivot: "$1.8 trillion invested in clean energy, surpassing fossil fuels", 
          conclusion: "14% of new car sales were electric in 2022, up from 4% in 2020" 
        }
      },
      {
        id: 9,
        title: "Digital Privacy Concerns",
        category: "Technology/Society",
        text: `"We have built a surveillance economy," warns privacy advocate Rebecca Torres. "The question is: do we want to live in it?" Data collection has reached unprecedented levels. "The average person's data is collected 747 times daily," reports the Digital Privacy Institute. "By whom? Hundreds of companies you've never heard of." Social media platforms are the worst offenders. "Meta collects an average of 2,300 data points per user," Torres reveals. "What do they know about us? More than our closest friends." The consequences are real. "78% of companies now use social media data in hiring decisions," states the Employment Practices Survey. "Is this fair?" asks Torres. "A photo from college can follow you forever." Data breaches are epidemic: 1,800 breaches exposed 422 million records in 2022. "How secure is our information?" asks cybersecurity expert David Kim. "Not very. The average company takes 277 days to identify a breach." Government surveillance has expanded dramatically. "The NSA collects 200 billion communications daily," reports the Surveillance Studies Center. "Is this legal?" asks Torres. "Courts are still deciding." The EU's GDPR has shown that regulation works: privacy complaints dropped 18% in regulated jurisdictions. "Will other regions follow?" asks Kim. "They must." Consumer awareness is growing: 67% of users have changed privacy settings in the past year. "Are people waking up?" asks Torres. "Finally."`,
        keyElements: { 
          topic: "Average person's data is collected 747 times daily", 
          pivot: "1,800 data breaches exposed 422 million records in 2022", 
          conclusion: "Privacy complaints dropped 18% in GDPR-regulated jurisdictions" 
        }
      },
      {
        id: 10,
        title: "Space Exploration Economics",
        category: "Science/Technology",
        text: `"Space is becoming big business," declares aerospace analyst Jennifer Walsh. "The question is: who profits?" The global space economy reached $469 billion in 2022, growing at 8% annually. "Satellites dominate: 77% of revenue comes from satellite services," Walsh reports. "But launch is where the action is." SpaceX has revolutionized the industry. "Reusable rockets reduced launch costs by 80%," states the Space Economics Institute. "What does this mean?" asks Walsh. "Access to space is now 10 times cheaper than a decade ago." The satellite internet market is exploding. "Starlink has 1.5 million subscribers and aims for 20 million by 2025," reports the Telecom Satellite Association. "Is this sustainable?" asks Dr. Robert Park, space policy expert. "The night sky is already cluttered: 8,000 satellites orbit Earth, up from 2,000 in 2019." Space debris poses a growing threat. "NASA tracks 47,000 objects larger than 10cm, but millions of smaller pieces go untracked," warns Park. "One collision could cascade into thousands more." Lunar and Mars missions are accelerating. "NASA's Artemis program will cost $93 billion through 2025," reports the Congressional Budget Office. "Is this worth it?" asks Walsh. "The moon contains resources worth trillions." Private investment is surging: $15.4 billion flowed to space startups in 2021. "Are we in a bubble?" asks Park. "Time will tell."`,
        keyElements: { 
          topic: "Global space economy reached $469 billion in 2022", 
          pivot: "Reusable rockets reduced launch costs by 80%", 
          conclusion: "Private investment of $15.4 billion flowed to space startups in 2021" 
        }
      },
      {
        id: 11,
        title: "Ocean Conservation Crisis",
        category: "Environment",
        text: `"Our oceans are dying, and we're watching it happen," warns marine biologist Dr. Carlos Mendez. "The question is: will we act before it's too late?" Ocean temperatures have risen 0.6¬∞C since 1900, triggering mass coral bleaching. "We've lost 50% of coral reefs already," Mendez reports. "At 1.5¬∞C warming, we lose 70%. At 2¬∞C, 99%. What will marine ecosystems look like then?" Overfishing has depleted fish stocks dramatically. "34% of fish populations are overfished," states the Marine Conservation Institute. "Can they recover?" asks Mendez. "Not at current exploitation rates." Plastic pollution chokes marine life. "8 million tons of plastic enter oceans annually," reports the Ocean Cleanup Foundation. "That's a garbage truck every minute. Is this acceptable?" Dead zones are expanding: 700 areas worldwide now experience hypoxia, up from 50 in 1950. "What kills the fish?" asks Dr. Sarah Liu, ocean chemist. "Agricultural runoff creates algal blooms that consume all oxygen." Ocean acidification threatens shell-forming organisms. "pH has dropped 0.1 units, representing a 30% increase in acidity," Liu reports. "What does this mean for food chains?" asks Mendez. "Collapse from the bottom up." Protected areas offer hope. "Marine reserves show 400% recovery in fish biomass," reports the Protected Seas Initiative. "Are we protecting enough?" asks Liu. "Only 7.7% of oceans are protected. We need 30% by 2030."`,
        keyElements: { 
          topic: "Ocean temperatures rose 0.6¬∞C, 50% of coral reefs lost", 
          pivot: "34% of fish populations are overfished", 
          conclusion: "Marine reserves show 400% recovery in fish biomass" 
        }
      },
      {
        id: 12,
        title: "Cryptocurrency Impact",
        category: "Finance/Technology",
        text: `"Cryptocurrency has created both fortunes and disasters," observes financial analyst Thomas Wright. "The question is: what comes next?" The market has been volatile: Bitcoin peaked at $69,000 in 2021, then crashed below $16,000 in 2022. "Who lost money?" asks Wright. "Retail investors who bought at the top. 52% of crypto buyers lost money overall." Institutional adoption is growing despite volatility. "MicroStrategy holds 140,000 Bitcoin worth billions," reports the Crypto Investment Review. "Is this wise?" asks Dr. Angela Foster, financial economist. "It's speculation, not investment." Energy consumption remains controversial. "Bitcoin mining uses 127 terawatt-hours annually, more than Argentina," states the Energy Blockchain Institute. "Can this be sustainable?" asks Wright. "Proof-of-stake alternatives use 99% less energy." Regulation is tightening globally. "The SEC filed 46 enforcement actions against crypto in 2022," reports the Regulatory Watch Group. "Is this the end of wild west crypto?" asks Foster. "Hopefully." DeFi (decentralized finance) has exploded. "$50 billion is locked in DeFi protocols," Wright notes. "But hacks stole $3.8 billion in 2022. Is your money safe?" Central bank digital currencies are emerging. "87 countries are exploring CBDCs," reports the Digital Currency Observatory. "Will this replace crypto?" asks Foster. "It will certainly compete."`,
        keyElements: { 
          topic: "Bitcoin peaked at $69,000 then crashed below $16,000", 
          pivot: "52% of crypto buyers lost money overall", 
          conclusion: "87 countries are exploring central bank digital currencies" 
        }
      },
      {
        id: 13,
        title: "Aging Population Challenges",
        category: "Demographics/Society",
        text: `"The world is getting older fast," declares demographer Dr. Yuki Tanaka. "The question is: are we prepared?" By 2050, the global population aged 60+ will double to 2.1 billion. "In Japan, 29% are already over 65," Tanaka reports. "Who will care for them?" The dependency ratio is shifting dramatically. "In 1950, there were 12 workers per retiree. By 2050, there will be 4," states the Global Aging Institute. "Can pension systems survive?" asks Tanaka. "Most are fundamentally insolvent." Healthcare costs are exploding. "Dementia care alone will cost $2 trillion annually by 2030," reports the Alzheimer's Research Foundation. "Where will this money come from?" asks Dr. Maria Santos, geriatric specialist. "Families are already struggling. 53 million Americans provide unpaid elder care." Labor shortages are emerging. "Germany faces a 5 million worker shortfall by 2035," Tanaka notes. "Will immigration fill the gap?" Automation offers partial solutions. "Elder care robots could address 40% of assistance needs," reports the Robotics Care Alliance. "Can robots replace human connection?" asks Santos. "Never completely." Silver economies present opportunities. "The 60+ market will control $15 trillion in spending by 2030," states the Senior Consumer Institute. "Are businesses adapting?" asks Tanaka. "Too slowly."`,
        keyElements: { 
          topic: "By 2050, global population aged 60+ will double to 2.1 billion", 
          pivot: "Dementia care will cost $2 trillion annually by 2030", 
          conclusion: "60+ market will control $15 trillion in spending by 2030" 
        }
      },
      {
        id: 14,
        title: "Biodiversity Loss",
        category: "Environment",
        text: `"We are in the sixth mass extinction," warns conservation biologist Dr. Rachel Green. "The question is: do we understand what's at stake?" Species are disappearing at 1,000 times the natural rate. "We've lost 68% of wildlife populations since 1970," Green reports. "What does this mean for ecosystems?" asks Dr. James Okonkwo, ecosystem scientist. "Collapse. Every species plays a role." Habitat destruction drives the crisis. "We've converted 75% of ice-free land for human use," states the Biodiversity Monitoring Center. "Is this reversible?" asks Green. "Not at current rates. We lose 10 million hectares of forest annually." Insect populations are crashing. "Flying insects declined 76% in protected areas over 27 years," reports the Entomological Research Institute. "Why does this matter?" asks Okonkwo. "80% of wild plants depend on insect pollination." Freshwater species are most at risk. "Wetland species populations fell 83%," Green notes. "What are we doing to our waterways?" asks Okonkwo. "Poisoning them with agricultural runoff and plastic." The economic value of biodiversity is enormous. "Ecosystem services provide $125 trillion annually," reports the Natural Capital Coalition. "Can we afford to lose this?" asks Green. "Absolutely not." Conservation works when funded. "Protected areas reduced species decline by 40%," states the Conservation Effectiveness Lab. "Are we investing enough?" asks Okonkwo. "We spend 10 times more on fossil fuel subsidies than conservation."`,
        keyElements: { 
          topic: "Species disappearing at 1,000 times natural rate, 68% of wildlife lost", 
          pivot: "75% of ice-free land converted for human use", 
          conclusion: "Protected areas reduced species decline by 40%" 
        }
      },
      {
        id: 15,
        title: "Water Scarcity Crisis",
        category: "Environment/Resources",
        text: `"Water will be the oil of the 21st century," predicts resource economist Dr. Amara Diallo. "The question is: who controls it?" 2.3 billion people already live in water-stressed countries. "By 2025, two-thirds of the world's population will face shortages," Diallo reports. "Where will they go?" Agriculture consumes 70% of freshwater withdrawals. "It takes 1,800 gallons to produce one pound of beef," states the Water Footprint Network. "Is this sustainable?" asks Dr. Peter Schmidt, hydrologist. "Not with current diets and population growth." Groundwater is being depleted rapidly. "21 of the world's 37 largest aquifers are receding," reports the Groundwater Monitoring Consortium. "Can they recharge?" asks Diallo. "Some take thousands of years. We're mining fossil water." Climate change intensifies scarcity. "Drought frequency has increased 29% since 2000," Schmidt notes. "What happens to farming?" asks Diallo. "In California's Central Valley, land has sunk 28 feet due to over-pumping." Water infrastructure is crumbling. "The US loses 6 billion gallons of treated water daily to leaks," reports the Infrastructure Assessment Group. "Is this acceptable?" asks Schmidt. "It's criminal negligence." Desalination offers partial relief. "Capacity grew 57% in the past decade," Diallo reports. "But energy costs remain high. Can renewables bridge the gap?" Water markets are emerging. "Australia's water trading saved $2 billion during drought," states the Water Economics Institute. "Will markets solve scarcity?" asks Diallo. "They'll help, but equity remains a concern."`,
        keyElements: { 
          topic: "2.3 billion people live in water-stressed countries", 
          pivot: "Agriculture consumes 70% of freshwater withdrawals", 
          conclusion: "Australia's water trading saved $2 billion during drought" 
        }
      },
      {
        id: 16,
        title: "Gender Equality Progress",
        category: "Social/Economics",
        text: `"We've made progress, but the gap remains vast," acknowledges gender economist Dr. Priya Nair. "The question is: why is change so slow?" The global gender pay gap stands at 20%, meaning women earn 80 cents for every dollar men earn. "At current rates, parity won't be achieved until 2158," Nair reports. "Will our great-great-granddaughters see equality?" asks Dr. Lisa Wong, workplace researcher. "Not without intervention." Boardroom representation is improving but inadequate. "Women hold 23% of board seats globally, up from 15% in 2015," states the Corporate Diversity Index. "Is this enough?" asks Nair. "Companies with 30%+ women on boards outperform peers by 48%." Unpaid care work falls disproportionately on women. "Women perform 76% of unpaid care work globally," reports the Care Economy Research Center. "What does this cost?" asks Wong. "$10.8 trillion in lost economic output annually." Education gaps are narrowing. "Girls now outnumber boys in tertiary education in 97 countries," Nair notes. "Why doesn't this translate to workplace equality?" asks Wong. "Discrimination, bias, and structural barriers." Political representation lags. "Women hold just 26% of parliamentary seats globally," reports the Parliamentary Union. "Does representation matter?" asks Nair. "Countries with more women in parliament invest more in health and education." Violence remains epidemic. "1 in 3 women experience physical or sexual violence," states the Gender Violence Observatory. "Is this being addressed?" asks Wong. "Laws exist in 155 countries, but enforcement is weak."`,
        keyElements: { 
          topic: "Global gender pay gap stands at 20%", 
          pivot: "Women perform 76% of unpaid care work globally", 
          conclusion: "Countries with more women in parliament invest more in health and education" 
        }
      },
      {
        id: 17,
        title: "Antibiotic Resistance Threat",
        category: "Health/Medicine",
        text: `"We are heading toward a post-antibiotic era," warns infectious disease specialist Dr. Robert Chen. "The question is: will we act in time?" Antibiotic-resistant infections kill 1.27 million people annually, more than HIV/AIDS or malaria. "By 2050, this could rise to 10 million deaths per year," Chen reports. "What will medicine look like?" asks Dr. Sarah Johnson, microbiologist. "Routine surgeries become life-threatening. Cancer chemotherapy becomes impossible." Overuse drives resistance. "70% of antibiotics sold in the US go to livestock," states the Antibiotic Stewardship Institute. "Is this necessary?" asks Chen. "It's profitable for agribusiness, but devastating for public health." New antibiotic development has stalled. "Only 43 new antibiotics are in development, compared to thousands of cancer drugs," reports the Pharmaceutical Innovation Center. "Why the disparity?" asks Johnson. "Antibiotics are unprofitable. You take them for a week; cancer drugs for years." Healthcare-acquired infections are rising. "2.8 million resistant infections occur in US hospitals annually," Chen notes. "Are hospitals doing enough?" asks Johnson. "Infection control varies dramatically." Alternative approaches show promise. "Phage therapy achieved 92% success in drug-resistant infections," reports the Bacteriophage Research Lab. "Can this scale?" asks Chen. "Regulatory frameworks need updating." Global coordination is lacking. "Only 42% of countries have national action plans," states the Global Health Security Index. "Is this sufficient?" asks Johnson. "Not even close."`,
        keyElements: { 
          topic: "Antibiotic-resistant infections kill 1.27 million people annually", 
          pivot: "70% of antibiotics sold in US go to livestock", 
          conclusion: "Phage therapy achieved 92% success in drug-resistant infections" 
        }
      },
      {
        id: 18,
        title: "Supply Chain Vulnerabilities",
        category: "Business/Economics",
        text: `"The pandemic exposed how fragile our supply chains are," observes logistics analyst David Park. "The question is: have we learned?" Supply chain disruptions cost companies an average of $184 million annually. "During COVID-19, 94% of Fortune 1000 companies experienced supply chain disruptions," Park reports. "What went wrong?" asks Dr. Elena Rodriguez, supply chain researcher. "We optimized for efficiency, not resilience." Just-in-time manufacturing created systemic risk. "Inventory levels dropped 45% over two decades," states the Supply Chain Resilience Institute. "Is this changing?" asks Park. "Companies are rebuilding buffers, but slowly." Geographic concentration is dangerous. "80% of semiconductor manufacturing is in Asia," Rodriguez notes. "What happens if Taiwan is disrupted?" asks Park. "The global economy stalls. One factory produces 92% of advanced chips." Shipping costs have stabilized but remain volatile. "Container rates spiked 500% in 2021," reports the Maritime Economics Center. "Are we prepared for the next shock?" asks Rodriguez. "Climate change threatens 40% of ports with flooding by 2050." Nearshoring is accelerating. "67% of companies are diversifying supply sources," Park reports. "Is this enough?" asks Rodriguez. "It takes 2-3 years to qualify new suppliers." Technology offers solutions. "AI-powered forecasting reduced stockouts by 35%," states the Digital Supply Chain Lab. "Can technology solve everything?" asks Park. "Not without human judgment."`,
        keyElements: { 
          topic: "Supply chain disruptions cost companies average $184 million annually", 
          pivot: "94% of Fortune 1000 companies experienced disruptions during COVID-19", 
          conclusion: "AI-powered forecasting reduced stockouts by 35%" 
        }
      },
      {
        id: 19,
        title: "Social Media and Democracy",
        category: "Technology/Society",
        text: `"Social media is reshaping democracy itself," declares political scientist Dr. Michael Torres. "The question is: for better or worse?" Disinformation spreads faster than truth. "False news is 70% more likely to be retweeted than true stories," reports the Digital Democracy Institute. "Why?" asks Torres. "It triggers stronger emotional responses." Political polarization has intensified. "Users in echo chambers are 67% more likely to hold extreme views," states the Political Polarization Lab. "Is this intentional?" asks Dr. Sarah Kim, media researcher. "Algorithms maximize engagement, and outrage engages." Election interference is escalating. "Foreign actors reached 126 million Americans on Facebook in 2016," Torres reports. "Has this improved?" asks Kim. "Platforms removed 6.5 billion fake accounts in 2021, but detection remains imperfect." Youth political engagement is transforming. "18-29 year olds who use social media are 47% more likely to vote," states the Civic Engagement Center. "Is this positive?" asks Torres. "Participation is up, but so is misinformation exposure." Platform power is unprecedented. "Facebook's algorithm shapes what 2.9 billion people see daily," Kim notes. "Should private companies control public discourse?" asks Torres. "Democracy requires transparency they're not providing." Regulatory responses are emerging. "EU's Digital Services Act imposes new accountability," reports the Tech Policy Observatory. "Will it work?" asks Kim. "It's a start, but enforcement will be challenging."`,
        keyElements: { 
          topic: "False news is 70% more likely to be retweeted than true stories", 
          pivot: "Foreign actors reached 126 million Americans on Facebook in 2016", 
          conclusion: "EU's Digital Services Act imposes new accountability on platforms" 
        }
      },
      {
        id: 20,
        title: "Nuclear Energy Debate",
        category: "Energy/Science",
        text: `"Nuclear power is our best tool against climate change," argues energy policy expert Dr. Jennifer Walsh. "The question is: can we overcome public fear?" Nuclear provides 10% of global electricity with near-zero emissions. "France's grid is 70% nuclear, with emissions 80% below Germany's," Walsh reports. "Why isn't everyone following?" asks Dr. Ahmed Hassan, energy economist. "Chernobyl and Fukushima created lasting trauma." Safety has improved dramatically. "Generation III+ reactors have 1 in 10 million year meltdown probability," states the Nuclear Safety Institute. "Is this acceptable?" asks Walsh. "Far safer than fossil fuels, which kill 8 million annually from air pollution." Waste remains contentious. "All US nuclear waste would fit on a single football field, 10 meters deep," Hassan notes. "But what do we do with it?" asks Walsh. "Finland's deep geological repository shows a viable path." Costs are the real barrier. "Nuclear plants cost $6-9 billion and take 10 years to build," reports the Energy Economics Center. "Can we afford this?" asks Hassan. "We can't afford not to. The social cost of carbon is $185 per ton." Small modular reactors offer hope. "SMRs could reduce costs by 50% and construction time by 60%," Walsh reports. "When will they deploy?" asks Hassan. "First commercial units expected by 2030." Public opinion is shifting. "Support for nuclear reached 51% in the US, up from 37% in 2016," states the Energy Opinion Tracker. "Is this enough?" asks Walsh. "Policy must follow public acceptance."`,
        keyElements: { 
          topic: "Nuclear provides 10% of global electricity with near-zero emissions", 
          pivot: "Nuclear plants cost $6-9 billion and take 10 years to build", 
          conclusion: "Small modular reactors could reduce costs by 50% and construction time by 60%" 
        }
      },
          {
        id: 21,
        title: "Total Quality Management in Educational Institutions",
        category: "Education/Quality Management",
        text: `The effective implementation of Total Quality Management (TQM) within educational institutions necessitates a multifaceted approach that integrates continuous improvement methodologies with stakeholder-centric service delivery frameworks (Crosby, 1979; Deming, 1986). Firstly, leadership commitment must transcend mere administrative endorsement, instead manifesting as active participation in quality audits and strategic alignment of institutional objectives with measurable performance indicators (Oakland, 2014). Secondly, faculty development programmes should incorporate competency-based training modules that emphasize both pedagogical innovation and adherence to standardized assessment protocols, thereby ensuring consistency in educational outcomes across diverse learner demographics. Furthermore, the establishment of robust feedback mechanisms‚Äîencompassing student satisfaction surveys, peer review systems, and external accreditation benchmarks‚Äîenables data-driven decision-making that identifies systemic inefficiencies while promoting a culture of accountability (Parasuraman et al., 1988). Consequently, institutions that successfully embed these quality dimensions into their operational DNA not only enhance their competitive positioning in global education markets but also demonstrate measurable improvements in student retention rates and graduate employability metrics.`,
        keyElements: {
          topic: "The effective implementation of Total Quality Management (TQM) within educational institutions necessitates a multifaceted approach that integrates continuous improvement methodologies with stakeholder-centric service delivery frameworks",
          pivot: "Leadership commitment must manifest as active participation in quality audits, faculty development programmes should incorporate competency-based training modules, and robust feedback mechanisms enable data-driven decision-making",
          conclusion: "Institutions that successfully embed these quality dimensions enhance their competitive positioning in global education markets and demonstrate measurable improvements in student retention rates and graduate employability metrics"
        }
      }
    ];

    let currentId = 1, easyMode = false, attempted = new Set();

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('totalProgress').textContent = passages.length;
  document.getElementById('totalNum').textContent = passages.length;
      loadPassage(1);
      renderDots();
      checkAIStatus();
    });

    async function checkAIStatus() {
      try {
        const res = await fetch(API_URL + '/api/health');
        const data = await res.json();
        const el = document.getElementById('aiStatus');
        if (data.anthropicConfigured) {
          el.innerHTML = '<span style="color: #4caf50;">‚óè</span> AI Ready';
          el.classList.remove('offline');
        } else {
          el.innerHTML = '<span style="color: #ff9800;">‚óè</span> Local Mode';
          el.classList.add('offline');
        }
      } catch (e) {
        document.getElementById('aiStatus').innerHTML = '<span style="color: #f44336;">‚óè</span> Offline';
        document.getElementById('aiStatus').classList.add('offline');
      }
    }

    function loadPassage(id) {
      currentId = id;
      const p = passages.find(x => x.id === id);
      if (!p) return;
      
      document.getElementById('currentNum').textContent = id;
      document.getElementById('totalNum').textContent = passages.length;
      document.getElementById('passageCategory').textContent = p.category;
      document.getElementById('passageTitle').textContent = p.title;
      document.getElementById('passageText').textContent = p.text;
      
      const kp = document.getElementById('keyPoints');
      kp.innerHTML = `
        <div class="key-point">
          <div class="kp-icon topic">T</div>
          <div><strong>Topic:</strong> ${p.keyElements?.topic || 'Main subject'}</div>
        </div>
        <div class="key-point">
          <div class="kp-icon pivot">P</div>
          <div><strong>Pivot:</strong> ${p.keyElements?.pivot || 'Contrast/shift'}</div>
        </div>
        <div class="key-point">
          <div class="kp-icon conclusion">C</div>
          <div><strong>Conclusion:</strong> ${p.keyElements?.conclusion || 'Outcome'}</div>
        </div>
      `;
      kp.classList.toggle('show', easyMode);
      document.getElementById('kpBtn').textContent = easyMode ? 'Click to hide key points' : 'Click to show key points';
      document.getElementById('prevBtn').disabled = id === 1;
      document.getElementById('nextBtn').disabled = id === passages.length;
      
      updateDots();
      document.getElementById('summaryInput').value = '';
      updateWordCount();
      document.getElementById('results').classList.remove('show');
    }

    function prevPassage() { if (currentId > 1) loadPassage(currentId - 1); }
    function nextPassage() { if (currentId < passages.length) loadPassage(currentId + 1); }

    function toggleEasyMode() {
      easyMode = !easyMode;
      document.getElementById('easyToggle').classList.toggle('active', easyMode);
      document.getElementById('keyPoints').classList.toggle('show', easyMode);
      document.getElementById('kpBtn').textContent = easyMode ? 'Click to hide key points' : 'Click to show key points';
    }

    function toggleKeyPoints() {
      const kp = document.getElementById('keyPoints');
      kp.classList.toggle('show');
      document.getElementById('kpBtn').textContent = kp.classList.contains('show') ? 'Click to hide key points' : 'Click to show key points';
    }

    function jumpToPassage() {
      const n = prompt('Enter passage (1-' + passages.length + '):');
      if (n >= 1 && n <= passages.length) loadPassage(parseInt(n));
    }

    function updateWordCount() {
      const text = document.getElementById('summaryInput').value.trim();
      const words = text ? text.split(/\s+/).length : 0;
      const el = document.getElementById('wordCount');
      el.textContent = words + ' words';
      el.className = 'word-count';
      if (words < 5 || words > 75) el.classList.add('error');
      else if (words >= 5 && words <= 75) el.classList.add('success');
    }

    async function verifySummary() {
      const text = document.getElementById('summaryInput').value.trim();
      const passage = passages.find(p => p.id === currentId);
      if (!text) { alert('Please enter a summary'); return; }
      const words = text.split(/\s+/).length;
      if (words < 5 || words > 75) { alert('Summary must be 5-75 words'); return; }
      
      document.getElementById('loadingOverlay').classList.add('show');
      
      try {
        const res = await fetch(API_URL + '/api/grade', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
  text: text, 
  type: 'summarize-written-text', 
  prompt: passage.text,
  keyPoints: passage.keyElements
})
        });
        
        if (!res.ok) throw new Error('Server error ' + res.status);
        const data = await res.json();
        showResults(data, passage);
        attempted.add(currentId);
        document.getElementById('completedCount').textContent = attempted.size;
        updateDots();
      } catch (e) {
        console.error(e);
        alert('Error: ' + e.message);
      } finally {
        document.getElementById('loadingOverlay').classList.remove('show');
      }
    }

    function showResults(data, passage) {
      document.getElementById('results').classList.add('show');
      
      // Form error banner
      const formErrorBanner = document.getElementById('formErrorBanner');
      if (data.form_gate_triggered) {
        formErrorBanner.style.display = 'block';
        document.getElementById('formErrorReason').textContent = data.form_reason || 'Form validation failed';
      } else {
        formErrorBanner.style.display = 'none';
      }
      
      // FIX: Normalize scores from backend
      const traits = data.trait_scores || {};
      const formScore = Math.min(1, traits.form || 0);
      let contentScore = traits.content || 0;
      if (contentScore > 2) contentScore = 2;
      const grammarScore = Math.min(2, traits.grammar || 0);
      const vocabScore = Math.min(2, traits.vocabulary || 0);
      
      // Calculate correct raw score (max 7)
      const correctedRawScore = formScore + contentScore + grammarScore + vocabScore;
      
      // Get content details
      const content = data.content_details || {};
      const keyIdeasPresent = content.key_ideas_present || [];
      const keyIdeasMissing = content.key_ideas_missing || [];
      
      // Use key_ideas_present array which contains actual types like ['topic', 'conclusion']
      const hasTopic = keyIdeasPresent.includes('topic');
      const hasPivot = keyIdeasPresent.includes('pivot');
      const hasConclusion = keyIdeasPresent.includes('conclusion');
      
      // Score header
      document.getElementById('mainScore').textContent = (data.overall_score || 0) + '/90';
      document.getElementById('bandDisplay').textContent = data.band || 'Band 5';
      document.getElementById('rawDisplay').textContent = 'Raw: ' + correctedRawScore + '/7';
      
      // Mode display
      const modeDisplay = document.getElementById('modeDisplay');
      if (data.mode === 'cached') {
        modeDisplay.innerHTML = '‚ö° Cached';
        modeDisplay.className = 'mode-tag cached';
      } else if (data.mode === 'ai') {
        modeDisplay.innerHTML = 'ü§ñ AI';
        modeDisplay.className = 'mode-tag';
      } else if (data.mode === 'error') {
        modeDisplay.innerHTML = '‚ö†Ô∏è Error';
        modeDisplay.className = 'mode-tag offline';
      } else {
        modeDisplay.innerHTML = 'üìä Local';
        modeDisplay.className = 'mode-tag';
      }
      
      // Feedback
      document.getElementById('feedbackText').textContent = data.feedback || 'No feedback available';
      
      // Content elements - use already calculated hasTopic/hasPivot/hasConclusion
      const extracted = content.key_ideas_extracted || [];
      
      document.getElementById('elementsGrid').innerHTML = `
        <div class="element-card ${hasTopic ? 'captured' : 'missed'}">
          <div class="element-header">
            <span class="element-label topic">Topic</span>
            <span class="element-check">${hasTopic ? '‚úì' : '‚úó'}</span>
          </div>
          <div class="element-text">${extracted[0] || (passage.keyElements?.topic || 'Main subject').substring(0, 60)}...</div>
        </div>
        <div class="element-card ${hasPivot ? 'captured' : 'missed'}">
          <div class="element-header">
            <span class="element-label pivot">Pivot</span>
            <span class="element-check">${hasPivot ? '‚úì' : '‚úó'}</span>
          </div>
          <div class="element-text">${extracted[1] || (passage.keyElements?.pivot || 'Contrast/shift').substring(0, 60)}...</div>
        </div>
        <div class="element-card ${hasConclusion ? 'captured' : 'missed'}">
          <div class="element-header">
            <span class="element-label conclusion">Conclusion</span>
            <span class="element-check">${hasConclusion ? '‚úì' : '‚úó'}</span>
          </div>
          <div class="element-text">${extracted[2] || (passage.keyElements?.conclusion || 'Outcome').substring(0, 60)}...</div>
        </div>
      `;
      
      // First person warning
      const firstPersonWarning = document.getElementById('firstPersonWarning');
      if (content.perspective_shift_penalty) {
        firstPersonWarning.style.display = 'block';
        document.getElementById('firstPersonContent').innerHTML = '<p>' + (content.perspective_note || "Use 'The author' instead of 'I' for first-person passages") + '</p>';
      } else {
        firstPersonWarning.style.display = 'none';
      }
      
      // Spelling issues
      const grammar = data.grammar_details || {};
      const spellSection = document.getElementById('spellCheckSection');
      if (grammar.spelling_errors && grammar.spelling_errors.length > 0) {
        spellSection.style.display = 'block';
        document.getElementById('spellCheckContent').innerHTML = grammar.spelling_errors.map(e => 
          `<div class="issue-item"><span class="issue-word">"${e.word || e}"</span>${e.suggestion ? `<span class="issue-arrow">‚Üí</span><span class="issue-fix">"${e.suggestion}"</span>` : ''}</div>`
        ).join('');
      } else {
        spellSection.style.display = 'none';
      }
      
      // Grammar issues
      const grammarSection = document.getElementById('grammarSection');
      const grammarIssues = grammar.grammar_issues || [];
      
      let connectorHtml = '';
      if (!grammar.has_connector) {
        connectorHtml = '<div class="issue-item">Add a connector (however, therefore, moreover) to improve grammar score</div>';
      } else if (!grammar.has_semicolon_before_connector) {
        connectorHtml = '<div class="issue-item">Use semicolon before connector: <strong>"; however,"</strong> not <strong>" however,"</strong></div>';
      }
      
      if (grammarIssues.length > 0 || connectorHtml) {
        grammarSection.style.display = 'block';
        document.getElementById('grammarContent').innerHTML = connectorHtml + grammarIssues.map(g => 
          `<div class="issue-item">${g.issue || g}</div>`
        ).join('');
      } else {
        grammarSection.style.display = 'none';
      }
      
      // Connector info
      const connectorInfo = document.getElementById('connectorInfo');
      const connAnalysis = data.connector_analysis || {};
      if (grammar.has_connector) {
        const typeClass = grammar.connector_type === 'contrast' ? 'contrast' : 
                         grammar.connector_type === 'addition' ? 'addition' : 
                         grammar.connector_type === 'result' ? 'reason' : '';
        const logicText = grammar.connector_logic_correct ? '‚úì Logic correct' : '‚úó Check logic';
        const logicClass = grammar.connector_logic_correct ? 'logic' : 'logic bad';
        const semicolon = grammar.has_semicolon_before_connector ? '' : ' | Missing semicolon!';
        connectorInfo.innerHTML = `<span class="type ${typeClass}">${grammar.connector_type}</span><span class="${logicClass}">${logicText}</span>${semicolon}`;
      } else if (connAnalysis.contrast?.length || connAnalysis.addition?.length || connAnalysis.result?.length) {
        const types = [];
        if (connAnalysis.contrast?.length) types.push('<span class="type contrast">contrast</span>');
        if (connAnalysis.addition?.length) types.push('<span class="type addition">addition</span>');
        if (connAnalysis.result?.length) types.push('<span class="type reason">result</span>');
        connectorInfo.innerHTML = types.join(' ') + ' <span class="logic bad">‚úó Missing semicolon before connector</span>';
      } else {
        connectorInfo.innerHTML = '<span style="color: #888;">No connector detected</span>';
      }
      
      // Vocabulary section
      const vocab = data.vocabulary_details || {};
      const vocabSection = document.getElementById('vocabSection');
      if (vocab) {
        vocabSection.style.display = 'block';
        let vocabHtml = `<p><strong>Synonym usage:</strong> ${vocab.synonym_usage || 'none'}</p>`;
        
        if (!vocab.unsafe_swaps_detected || vocab.unsafe_swaps_detected.length === 0) {
     const verbatimRate = vocab.verbatim_rate || '0%';
const paraphraseRate = vocab.paraphrase_rate || '100%';
vocabHtml += `<p style="color: #388e3c; font-size: 0.85rem; margin-top: 8px;">‚úì Verbatim: ${verbatimRate} | Paraphrased: ${paraphraseRate}</p>`;
        }
        
        if (vocab.smart_swaps_detected && vocab.smart_swaps_detected.length > 0) {
          vocabHtml += '<p style="margin-top: 8px;"><strong>Good swaps:</strong> ' + vocab.smart_swaps_detected.map(s => `<span class="vocab-badge swap">${s}</span>`).join('') + '</p>';
        }
        if (vocab.unsafe_swaps_detected && vocab.unsafe_swaps_detected.length > 0) {
          vocabHtml += '<p style="margin-top: 8px;"><strong>‚ö†Ô∏è Risky swaps:</strong> ' + vocab.unsafe_swaps_detected.map(s => `<span class="vocab-badge compression">${s}</span>`).join('') + '</p>';
        }
        if (vocab.verbatim_phrases && vocab.verbatim_phrases.length > 0) {
          vocabHtml += '<p style="margin-top: 8px; font-size: 0.8rem; color: #666;"><strong>Verbatim phrases detected:</strong> ' + vocab.verbatim_phrases.slice(0, 3).join(', ') + (vocab.verbatim_phrases.length > 3 ? '...' : '') + '</p>';
        }
        document.getElementById('vocabContent').innerHTML = vocabHtml;
      } else {
        vocabSection.style.display = 'none';
      }
      
      // Band 9 Insights
      const insightsSection = document.getElementById('insightsSection');
      const insights = data.band_9_insights;
      if (insights) {
        insightsSection.style.display = 'block';
        document.getElementById('insightsContent').innerHTML = `
          <div style="background: rgba(25, 118, 210, 0.1); padding: 12px; border-radius: 6px; font-size: 0.85rem;">
            <div style="margin-bottom: 6px;"><span style="color: #1976d2; font-weight: bold;">‚úì</span> ${insights.word_count_flexibility}</div>
            <div style="margin-bottom: 6px;"><span style="color: #1976d2; font-weight: bold;">‚úì</span> ${insights.scan_method}</div>
            <div style="margin-bottom: 6px;"><span style="color: #1976d2; font-weight: bold;">‚úì</span> ${insights.connector_style}</div>
            <div><span style="color: #1976d2; font-weight: bold;">‚úì</span> Verbatim acceptable: ${insights.verbatim_acceptable ? 'Yes' : 'No'}</div>
          </div>
        `;
      } else {
        insightsSection.style.display = 'none';
      }
      
      // FIX: Adjust grammar score display if no connector (max should be 1 without connector)
      const displayGrammarScore = grammar.has_connector ? grammarScore : Math.min(1, grammarScore);
      
      // Trait scores - use normalized values
      document.getElementById('traitsGrid').innerHTML = `
        <div class="trait-box ${formScore >= 1 ? 'good' : 'poor'}">
          <div class="trait-name">Form</div>
          <div class="trait-score">${formScore}/1</div>
          <div class="trait-detail">${data.word_count || 0} words</div>
        </div>
        <div class="trait-box ${contentScore >= 2 ? 'good' : contentScore >= 1 ? 'medium' : 'poor'}">
          <div class="trait-name">Content</div>
          <div class="trait-score">${contentScore}/2</div>
          <div class="trait-detail">T:${hasTopic ? '‚úì' : '‚úó'} P:${hasPivot ? '‚úì' : '‚úó'} C:${hasConclusion ? '‚úì' : '‚úó'}</div>
        </div>
        <div class="trait-box ${displayGrammarScore >= 2 ? 'good' : displayGrammarScore >= 1 ? 'medium' : 'poor'}">
          <div class="trait-name">Grammar</div>
          <div class="trait-score">${displayGrammarScore}/2</div>
          <div class="trait-detail">${grammar.has_connector ? (grammar.has_semicolon_before_connector ? '‚úì connector' : '‚úì no semi') : '‚úó none'}</div>
        </div>
        <div class="trait-box ${vocabScore >= 2 ? 'good' : vocabScore >= 1 ? 'medium' : 'poor'}">
          <div class="trait-name">Vocabulary</div>
          <div class="trait-score">${vocabScore}/2</div>
          <div class="trait-detail">${vocab.synonym_usage || 'N/A'}</div>
        </div>
      `;
      
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }

    function renderDots() {
      document.getElementById('passageDots').innerHTML = passages.map((p, i) => 
        `<div class="dot" data-id="${i+1}" onclick="loadPassage(${i+1})">${i+1}</div>`
      ).join('');
    }

    function updateDots() {
      document.querySelectorAll('.dot').forEach(d => {
        const id = parseInt(d.dataset.id);
        d.classList.toggle('active', id === currentId);
        d.classList.toggle('attempted', attempted.has(id));
      });
    }

    function showInstructions() {
      document.getElementById('instructionsModal').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeInstructions(event) {
      if (!event || event.target.id === 'instructionsModal' || event.target.classList.contains('btn-close')) {
        document.getElementById('instructionsModal').classList.remove('show');
        document.body.style.overflow = '';
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeInstructions();
    });

    let timerRunning = false, timerInterval, seconds = 0;
    function toggleTimer() {
      timerRunning = !timerRunning;
      if (timerRunning) {
        seconds = 0;
        timerInterval = setInterval(() => {
          seconds++;
          const m = Math.floor(seconds / 60), s = seconds % 60;
          document.getElementById('timerText').textContent = m + ':' + s.toString().padStart(2, '0');
        }, 1000);
      } else {
        clearInterval(timerInterval);
        document.getElementById('timerText').textContent = 'Off';
      }
    }
  </script>
</body>
</html>
  </script>
</body>
</html>
